---
- name: Vps-control
  hosts: home
  tasks:
    - name: Ensure dir exists
      ansible.builtin.file:
        path: "{{ dir }}"
        state: directory
        mode: "0755"
    - name: Write service file
      become: true
      ansible.builtin.template:
        src: templates/vps-control/vps-control.service.j2
        dest: /etc/systemd/system/vps-control.service
        mode: "0600"
        owner: root
        group: root
      notify:
        - Restart service
    - name: Flush handlers
      ansible.builtin.meta: flush_handlers
    - name: Ensure service is running
      become: true
      ansible.builtin.service:
        name: vps-control
        state: started
        enabled: true

  handlers:
    - name: Restart service
      become: true
      ansible.builtin.systemd:
        name: vps-control
        state: restarted
        daemon_reload: true

  vars:
    dir: "{{ deploy_dir }}/vps-control"
    vps_control_ovh_app_key: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      61643038366663656530343834616237636635386433373439643930313931636363633330343638
      6432383733643331393531366364333431666366343363320a373736353335643335356334616561
      63636530383732623364636538366363333037353632343233663234623839656535623735663633
      6633303661656266350a376637633532346464346561383333353236623337366565653664393762
      64623738323733656231623461633432616163643132643530373666323065373233
    vps_control_ovh_app_secret: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      32616664366136623432343138326465313932333132383331336534363363636565643832323636
      6161613465653165633432323833356537636562643132630a393634323838346131653364303239
      62313237633039613737613462373063343532623731656165613062373064336237326339666161
      3334313031386532610a383132303238643131353030383039666465613633336333343265643838
      34376562346137613034333235343834363330353264376438666630633431656163326133646338
      3131643732646330616562343831343236353139663663326265
    vps_control_ovh_consumer_key: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      32396534353030653966303164303964613464323434666338306434663731363061643733386231
      3563643362663033353231363031303164303537393466660a303031396165623966313437653730
      66386637366535326666613062663537353362663164366562333436316331323364343636616230
      3637633965643633660a633330333536366231346265626539636161336265613565356435313365
      65656136666231666539626664653139396562396235626461343062643262383531633539353465
      3732333730303264343531353235386462333462336637656536

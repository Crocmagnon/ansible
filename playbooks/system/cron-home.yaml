---
- name: Setup crontab
  hosts: servers
  gather_facts: false
  tasks:
    - name: Cron - Docker system prune
      ansible.builtin.cron:
        name: docker system prune
        minute: 0
        hour: 4
        weekday: SUN
        job: "{{ deploy_dir }}/bin/healthcheck docker-system-prune {{ deploy_dir }}/bin/docker-system-prune"
    - name: Cron - Dump voyages.coccomagnard.fr
      ansible.builtin.cron:
        name: Dump voyages.coccomagnard.fr
        minute: 55
        job: "{{ deploy_dir }}/bin/healthcheck dump-voyages-coccomagnard-fr {{ deploy_dir }}/bin/dump-voyages.coccomagnard.fr"
    - name: Cron - Dump gabnotes.org
      ansible.builtin.cron:
        name: Dump gabnotes.org
        minute: 56
        job: "{{ deploy_dir }}/bin/healthcheck dump-gabnotes-org {{ deploy_dir }}/bin/dump-gabnotes.org"
    - name: Cron - Dump voyages-lois.augendre.info
      ansible.builtin.cron:
        name: Dump voyages-lois.augendre.info
        minute: 57
        job: "{{ deploy_dir }}/bin/healthcheck dump-voyages-lois-augendre-info {{ deploy_dir }}/bin/dump-voyages-lois.augendre.info"
    - name: Cron - Restart plex container for auto version check
      ansible.builtin.cron:
        name: Restart plex container for auto version check
        minute: 0
        hour: 8
        job: /usr/bin/docker compose -f {{ deploy_dir }}/media/docker-compose.yaml restart plex
    - name: Cron - Sync pCloud
      ansible.builtin.cron:
        name: Sync pCloud
        minute: 0
        hour: 4
        job: "{{ deploy_dir }}/bin/healthcheck sync-pcloud {{ deploy_dir }}/bin/sync-pcloud"

- name: lyon-transports
  hosts: servers
  tasks:
    - name: write lyon-transports unit file
      become: true
      template:
        src: templates/lyon-transports.service.j2
        dest: /etc/systemd/system/lyon-transports.service
      notify:
        - daemon-reload
        - restart lyon-transports
    - name: ensure lyon-transports is running
      become: true
      service:
        name: lyon-transports
        state: started
        enabled: true

  handlers:
    - name: daemon-reload
      become: true
      systemd:
        daemon_reload: true
    - name: restart lyon-transports
      become: true
      service:
        name: lyon-transports
        state: restarted

  vars:
    lyon_transports_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      35356364616633356164376433623139333165626433303437666266613762643239373730616131
      6463316639393663396462383461306330636531663166380a623166666631303361346333323363
      62656138313133323637356363313564323634616363333237336338633365333236363637396432
      3566303038333234650a343861366331346532666532666363323863326461313639303238623039
      64326435353962616464666663613763316662326432363334383363336539356639323632623132
      63306638663038326364626132616161616665393132316163616638646539346466313562346330
      396162653537663634316439386636393534
    lyon_transports_username: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      35646462383237353130323736613632336664643633396163363561396562623963313664383666
      6239376430316663303836656230396636626533323361320a353637666362646364636431653862
      39613062303438356436613733396164646662333938353433313135356531373139323939653335
      3730663430656439640a613532326434343438656330363964303766363666393962393065663938
      30643033303263346538353564333535656437336639336461363261623435656131

- name: goatcounter
  hosts: servers
  tasks:
    - name: write goatcounter unit file
      become: true
      template:
        src: templates/goatcounter.service.j2
        dest: /etc/systemd/system/goatcounter.service
      notify:
        - daemon-reload
        - restart goatcounter
    - name: ensure goatcounter is running
      become: true
      service:
        name: goatcounter
        state: started
        enabled: true

  handlers:
    - name: daemon-reload
      become: true
      systemd:
        daemon_reload: true
    - name: restart goatcounter
      become: true
      service:
        name: goatcounter
        state: restarted

  vars:
    gc_mailgun_api_key: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      31386237653033306338393237353961396535363061363931643863653461333631376365663338
      3266346337353564656539666235656265356435343834380a616232383839663639616537393233
      64303764306639636136346233366666633765393565353062396632636163643031616235303130
      3662343162643033380a326161313036643835636562636165356464393236303533303435353365
      36336163313338346235396565363631366564393562326536353262363637653432643830663532
      30356133383335653330613965623261323531613131663437363430636565393262353565326132
      323830313235313462633335333763363161